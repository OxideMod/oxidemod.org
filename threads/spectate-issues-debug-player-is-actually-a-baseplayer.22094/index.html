<!DOCTYPE html>
<html id="XenForo" lang="en-US" dir="LTR" class="Public NoJs LoggedOut NoSidebar  Responsive" xmlns:fb="http://www.facebook.com/2008/fbml">
<head>

	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
	
		<meta name="viewport" content="width=device-width, initial-scale=1" />
	
	
		<base href="https://oxidemod.org/" />
		<script>
			var _b = document.getElementsByTagName('base')[0], _bH = "https://oxidemod.org/";
			if (_b && _b.href != _bH) _b.href = _bH;
		</script>
	

	<title>Solved - Spectate Issues - [Debug] Player is actually a BasePlayer | Oxide</title>
	
	<noscript><style>.JsOnly, .jsOnly { display: none !important; }</style></noscript>
	<link rel="stylesheet" href="css.php?css=xenforo,form,public&amp;style=5&amp;dir=LTR&amp;d=1548612011" />
	<link rel="stylesheet" href="css.php?css=bb_code,message,message_user_info,thread_view&amp;style=5&amp;dir=LTR&amp;d=1548612011" />
	
	

	
		<script src="js/jquery/jquery-1.11.0.min.js"></script>	
		
	<script src="js/xenforo/xenforo.js?_v=f33b43a2"></script>

	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
	<meta name="mobile-web-app-capable" content="yes" />
<link rel="icon" sizes="196x196" href="https://oxidemod.org/styles/oxide/logo.og.png" />
<link rel="apple-touch-icon" href="https://oxidemod.org/styles/oxide/logo.og.png" />
	<link rel="alternate" type="application/rss+xml" title="RSS feed for Oxide" href="forums/-/index.rss" />
		
	
	<link rel="canonical" href="https://oxidemod.org/threads/spectate-issues-debug-player-is-actually-a-baseplayer.22094/" />
	<meta name="description" content="Hello,

At the moment in my mod I intercept players' commands &quot;respawn&quot; and &quot;spectate&quot; using the OnServerCommand() hook.

It all works fine and with my..." />	<meta property="og:site_name" content="Oxide" />
	<meta property="og:image" content="https://oxidemod.org/styles/default/xenforo/avatars/avatar_m.png" />
	<meta property="og:image" content="https://oxidemod.org/styles/oxide/logo.og.png" />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="https://oxidemod.org/threads/spectate-issues-debug-player-is-actually-a-baseplayer.22094/" />
	<meta property="og:title" content="Solved - Spectate Issues - [Debug] Player is actually a BasePlayer" />
	<meta property="og:description" content="Hello,

At the moment in my mod I intercept players' commands &quot;respawn&quot; and &quot;spectate&quot; using the OnServerCommand() hook.

It all works fine and with my..." />
	
	
	

</head>

<body class="node4 node1 node104 node105 SelectQuotable">




<div id="headerMover">
	<div id="headerProxy"></div>

<div id="content" class="thread_view">
	<div class="pageWidth">
		<div class="pageContent">
			
			
			

			

			
			
				<div class="breadBoxTop ">
					
					

<nav>
	
		
			
				
			
		
			
				
			
		
			
				
			
		
			
				
			
		
	

	<fieldset class="breadcrumb">			
		<div class="boardTitle"><strong>Oxide</strong></div>
		
		<span class="crumbs">
			
				

					
						<span class="crust selectedTabCrumb" itemscope="itemscope" itemtype="http://data-vocabulary.org/Breadcrumb">
							<a href="https://oxidemod.org/" class="crumb" rel="up" itemprop="url"><span itemprop="title">Forums</span></a>
							<span class="arrow"><span>&gt;</span></span>
						</span>
					

					
						
							<span class="crust" itemscope="itemscope" itemtype="http://data-vocabulary.org/Breadcrumb">
								<a href="https://oxidemod.org/#oxide-project.1" class="crumb" rel="up" itemprop="url"><span itemprop="title">Oxide Project</span></a>
								<span class="arrow"><span>&gt;</span></span>
							</span>
						
							<span class="crust" itemscope="itemscope" itemtype="http://data-vocabulary.org/Breadcrumb">
								<a href="https://oxidemod.org/categories/archive.104/" class="crumb" rel="up" itemprop="url"><span itemprop="title">Archive</span></a>
								<span class="arrow"><span>&gt;</span></span>
							</span>
						
							<span class="crust" itemscope="itemscope" itemtype="http://data-vocabulary.org/Breadcrumb">
								<a href="https://oxidemod.org/categories/plugin-development.105/" class="crumb" rel="up" itemprop="url"><span itemprop="title">Plugin Development</span></a>
								<span class="arrow"><span>&gt;</span></span>
							</span>
						
							<span class="crust" itemscope="itemscope" itemtype="http://data-vocabulary.org/Breadcrumb">
								<a href="https://oxidemod.org/forums/rust-development.4/" class="crumb" rel="up" itemprop="url"><span itemprop="title">Rust Development</span></a>
								<span class="arrow"><span>&gt;</span></span>
							</span>
						
					
				
			
		</span>
	</fieldset>
</nav>
				</div>
			
			
	
			



			
				

						
			
			
			
						
						
													
								<!-- h1 title, description -->
								<div class="titleBar">
									
									<h1>
										
											
												<span class="prefix prefixGreen">Solved</span> <a href="https://oxidemod.org/threads/spectate-issues-debug-player-is-actually-a-baseplayer.22094/">Spectate Issues - [Debug] Player is actually a BasePlayer</a>
											
										
									</h1>

									<p id="pageDescription" class="muted ">
	Discussion in '<a href="forums/rust-development.4/">Rust Development</a>' started by <a class="username" dir="auto">TeamRequem</a>, <a href="threads/spectate-issues-debug-player-is-actually-a-baseplayer.22094/"><span class="DateTime" title="Nov 23, 2016 at 3:57 AM">Nov 23, 2016</span></a>.
</p>
								</div>
							
						
						
						
						

						

	

























	




<div class="pageNavLinkGroup">
	<div class="linkGroup SelectionCountContainer">
		
		
	</div>

	
</div>






<form action="inline-mod/post/switch" method="post"
	class="InlineModForm section"
	data-cookieName="posts"
	data-controls="#InlineModControls"
	data-imodOptions="#ModerationSelect option">

	<ol class="messageList" id="messageList">
		
			
				


<li id="post-270406" class="message   " data-author="TeamRequem">

	

<div class="messageUserInfo" itemscope="itemscope" itemtype="http://data-vocabulary.org/Person">	
<div class="messageUserBlock ">
	
		<div class="avatarHolder">
			<span class="helper"></span>
			<a class="avatar Avm" data-avatarhtml="true"><img src="styles/default/xenforo/avatars/avatar_m.png" width="96" height="96" alt="TeamRequem" /></a>
			
			
		</div>
	


	
		<h3 class="userText">
			<a class="username" dir="auto">TeamRequem</a>
			
			
		</h3>
	
		
	
		


	<span class="arrow"><span></span></span>
</div>
</div>

	<div class="messageInfo primaryContent">
		
		
		
		
		
		<div class="messageContent">		
			<article>
				<blockquote class="messageText SelectQuoteContainer ugc baseHtml">
					
					Hello,<br />
<br />
At the moment in my mod I intercept players&#039; commands &quot;respawn&quot; and &quot;spectate&quot; using the OnServerCommand() hook.<br />
<br />
It all works fine and with my code the player can spectate and respawn under certain conditions.<br />
<br />
The problem is that when a player who is spectating another player, if the second player disconnects while he is BEING spectated, the spectator is left spectating the air, unable to do anything besides reconnect to fix the issue (spectate and respawn commands throw an exception as they get intercepted - read on...). Apparently, this causes the player, who I retrieve from arg.connection.player, to have a null value as a result of which leads to the message status in the title, namely [Debug] Player is actually a BasePlayer (leads to an exception in my code as well, but that is just a symptom).<br />
<br />
Is this an issue that exists and has anyone else received it? Any possible reasons why this might be caused?<br />
<br />
Here are snippets of relevant code:<br />


<div class="bbCodeBlock bbCodeCode">
	<div class="type">Code:</div>
	<pre>        object OnServerCommand(ConsoleSystem.Arg arg)
        {
            if (arg.connection == null)
            {
                return null;
            }

            if (arg?.cmd?.namefull == &quot;global.spectate&quot;) {
                CmdSpectate(player, &quot;&quot;, target);
                return true;
            }

            return null;
        }</pre>
</div>

<div class="bbCodeBlock bbCodeCode">
	<div class="type">Code:</div>
	<pre>if (!player.IsSpectating())
{
        var target = (args.Length &gt; 0 ? BasePlayer.Find(args[0]) : null);

        //*

        // Put player in spectate mode
        player.SetPlayerFlag(BasePlayer.PlayerFlags.Spectating, true);
        player.gameObject.SetLayerRecursive(10);
        player.CancelInvoke(&quot;MetabolismUpdate&quot;);
        player.CancelInvoke(&quot;InventoryUpdate&quot;);
        player.ClearEntityQueue();
        entitySnapshot.Invoke(player, new object[] { target });
        player.gameObject.Identity();
        player.SetParent(target, 0);
        player.Die();
} else {
        Respawn(player);
}</pre>
</div>//* I omitted the code which sets the target to spectate. It&#039;s essentially a custom list of players which is managed by the plugin and one of the players is picked everytime someone writes &#039;/spectate&#039;.<br />
<br />
Also note Respawn() is a custom function which again checks a certain amount of conditions and at one point calls RespawnAt(), which is built-in into the BasePlayer class. Issue is essentially somewhere else and not involved with the actual respawning.
					<div class="messageTextEndMarker">&nbsp;</div>
				</blockquote>
			</article>
			
			
		</div>
		
		
		
		
		
		
		
				
		<div class="messageMeta ToggleTriggerAnchor">
			
			<div class="privateControls">
				
				<span class="item muted">
					<span class="authorEnd"><a class="username author" dir="auto">TeamRequem</a>,</span>
					<a href="threads/spectate-issues-debug-player-is-actually-a-baseplayer.22094/" title="Permalink" class="datePermalink"><span class="DateTime" title="Nov 23, 2016 at 3:57 AM">Nov 23, 2016</span></a>
				</span>
				
				
				
				
				
				
				
				
				
				
				
			</div>
			
			<div class="publicControls">
				<a href="threads/spectate-issues-debug-player-is-actually-a-baseplayer.22094/" title="Permalink" class="item muted postNumber hashPermalink OverlayTrigger" data-href="posts/270406/permalink">#1</a>
				
				
				
				
			</div>
		</div>
	</div>

	
	
	
	
</li>
			
		
			
				


<li id="post-270411" class="message  staff " data-author="Wulf">

	

<div class="messageUserInfo" itemscope="itemscope" itemtype="http://data-vocabulary.org/Person">	
<div class="messageUserBlock ">
	
		<div class="avatarHolder">
			<span class="helper"></span>
			<a class="avatar Avm" data-avatarhtml="true"><img src="{{ '/assets/styles/oxide/logo.og.png' | prepend: site.baseurl }}" width="96" height="96" alt="Wulf" /></a>
			
			
		</div>
	


	
		<h3 class="userText">
			<a class="username" dir="auto" itemprop="name">Wulf</a>
			<em class="userBanner bannerRed wrapped" itemprop="title"><span class="before"></span><strong>Community Admin</strong><span class="after"></span></em>
			
		</h3>
	
		
	
		


	<span class="arrow"><span></span></span>
</div>
</div>

	<div class="messageInfo primaryContent">
		
		
		
		
		
		<div class="messageContent">		
			<article>
				<blockquote class="messageText SelectQuoteContainer ugc baseHtml">
					
					Have you looked at my Spectate plugin?
					<div class="messageTextEndMarker">&nbsp;</div>
				</blockquote>
			</article>
			
			
		</div>
		
		
		
		
		
		
		
				
		<div class="messageMeta ToggleTriggerAnchor">
			
			<div class="privateControls">
				
				<span class="item muted">
					<span class="authorEnd"><a class="username author" dir="auto">Wulf</a>,</span>
					<a href="threads/spectate-issues-debug-player-is-actually-a-baseplayer.22094/#post-270411" title="Permalink" class="datePermalink"><span class="DateTime" title="Nov 23, 2016 at 5:18 AM">Nov 23, 2016</span></a>
				</span>
				
				
				
				
				
				
				
				
				
				
				
			</div>
			
			<div class="publicControls">
				<a href="threads/spectate-issues-debug-player-is-actually-a-baseplayer.22094/#post-270411" title="Permalink" class="item muted postNumber hashPermalink OverlayTrigger" data-href="posts/270411/permalink">#2</a>
				
				
				
				
			</div>
		</div>
	</div>

	
	
	
	
</li>
			
		
			
				


<li id="post-270425" class="message   " data-author="TeamRequem">

	

<div class="messageUserInfo" itemscope="itemscope" itemtype="http://data-vocabulary.org/Person">	
<div class="messageUserBlock ">
	
		<div class="avatarHolder">
			<span class="helper"></span>
			<a class="avatar Avm" data-avatarhtml="true"><img src="styles/default/xenforo/avatars/avatar_m.png" width="96" height="96" alt="TeamRequem" /></a>
			
			
		</div>
	


	
		<h3 class="userText">
			<a class="username" dir="auto">TeamRequem</a>
			
			
		</h3>
	
		
	
		


	<span class="arrow"><span></span></span>
</div>
</div>

	<div class="messageInfo primaryContent">
		
		
		
		
		
		<div class="messageContent">		
			<article>
				<blockquote class="messageText SelectQuoteContainer ugc baseHtml">
					
					Hey Wulf, sorry for my stupidity. I used the Spectate plugin a while ago and had it ready in my local resources and checked before writing, but last time I needed it I manually removed certain bits and resultingly had the wrong contents.<br />
<br />
Redownloaded it and double-checked, got a working solution now, all set!
					<div class="messageTextEndMarker">&nbsp;</div>
				</blockquote>
			</article>
			
			
		</div>
		
		
		
		
		
		
		
				
		<div class="messageMeta ToggleTriggerAnchor">
			
			<div class="privateControls">
				
				<span class="item muted">
					<span class="authorEnd"><a class="username author" dir="auto">TeamRequem</a>,</span>
					<a href="threads/spectate-issues-debug-player-is-actually-a-baseplayer.22094/#post-270425" title="Permalink" class="datePermalink"><span class="DateTime" title="Nov 23, 2016 at 10:42 AM">Nov 23, 2016</span></a>
				</span>
				
				
				
				
				
				
				
				
				
				
				
			</div>
			
			<div class="publicControls">
				<a href="threads/spectate-issues-debug-player-is-actually-a-baseplayer.22094/#post-270425" title="Permalink" class="item muted postNumber hashPermalink OverlayTrigger" data-href="posts/270425/permalink">#3</a>
				
				
				
				
			</div>
		</div>
	</div>

	
	
	
	
</li>
			
		
		
	</ol>

	

	

</form>


	<div class="pageNavLinkGroup">
		
			
				<div class="linkGroup">
					
				</div>
			
			<div class="linkGroup" style="display: none"><a href="javascript:" class="muted JsOnly DisplayIgnoredContent Tooltip" title="Show hidden content by ">Show Ignored Content</a></div>

			
		
	</div>












	


												
												
					
			
						
			
						
			


			<footer>
				


<div class="footer">
		<div class="pageContent">
			
            
            
            </div>
			
		
			
			
			<span class="helper"></span>
			<ul class="footerLinks">
			
				
				<li><a href="https://oxidemod.org/terms/">Terms and Rules</a></li>
				
				
				<li><a href="https://umod.org/community" target="_blank">Contact Us</a></li>
			
			</ul>
			
			<span class="helper"></span>
		</div>
</div>

			</footer>
		</div>
	</div>
</div>

<header>
	


<div id="header">
	<div class="headerWidth">
		<div id="logoBlock">
			
			
			<div id="logo"><a href="https://oxidemod.org/">
				<span></span>
				<img src="styles/oxide/logo.png" alt="Oxide" />
			</a></div>
			
			
			<span class="helper"></span>

</div>
		


<div id="navigation" class="">
	<div class="pageContent">
		<nav>
			<div class="navTabs">
				<ul class="publicTabs">

					
					

					
					

					
					
						<li class="navTab forums Popup PopupControl PopupClosed PopupContainerControl">
							<a href="https://oxidemod.org/" class="navLink" rel="Menu">Forums</a>

							
						</li>
					

					<li class="navTab PopupClosed">
	<a href="https://umod.org/documentation" class="navLink">Docs</a>
</li>


					
					
						
							<li class="navTab Popup PopupControl PopupClosed PopupContainerControl">

							<a href="https://oxidemod.org/downloads/" class="navLink" rel="Menu"> Downloads </a>

							
						</li>
						
					
						
							<li class="navTab Popup PopupControl PopupClosed PopupContainerControl">

							<a href="https://oxidemod.org/plugins/" class="navLink" rel="Menu"> Plugins </a>

							
						</li>
						
					
					

					
					

					
					

					
					<li class="navTab selected"><div class="tabLinks"></div></li>
				</ul>

				
				
			</div>

			<span class="helper"></span>
		</nav>
	</div>
</div>
	</div>
</div>

	
	
</header>

</div>

<script>


jQuery.extend(true, XenForo,
{
	visitor: { user_id: 0 },
	serverTimeInfo:
	{
		now: 1548657546,
		today: 1548633600,
		todayDow: 1
	},
	_lightBoxUniversal: "0",
	_enableOverlays: "1",
	_animationSpeedMultiplier: "1",
	_overlayConfig:
	{
		top: "10%",
		speed: 200,
		closeSpeed: 100,
		mask:
		{
			color: "rgb(255, 255, 255)",
			opacity: "0.6",
			loadSpeed: 200,
			closeSpeed: 100
		}
	},
	_ignoredUsers: [],
	_loadedScripts: {"thread_view":true,"message":true,"bb_code":true,"message_user_info":true},
	_cookieConfig: { path: "/", domain: ".oxidemod.org", prefix: "ih_xfid_"},
	_csrfToken: "",
	_csrfRefreshUrl: "login/csrf-token-refresh",
	_jsVersion: "f33b43a2"
});
jQuery.extend(XenForo.phrases,
{
	cancel: "Cancel",

	a_moment_ago:    "A moment ago",
	one_minute_ago:  "1 minute ago",
	x_minutes_ago:   "%minutes% minutes ago",
	today_at_x:      "Today at %time%",
	yesterday_at_x:  "Yesterday at %time%",
	day_x_at_time_y: "%day% at %time%",

	day0: "Sunday",
	day1: "Monday",
	day2: "Tuesday",
	day3: "Wednesday",
	day4: "Thursday",
	day5: "Friday",
	day6: "Saturday",

	_months: "January,February,March,April,May,June,July,August,September,October,November,December",
	_daysShort: "Sun,Mon,Tue,Wed,Thu,Fri,Sat",

	following_error_occurred: "The following error occurred",
	server_did_not_respond_in_time_try_again: "The server did not respond in time. Please try again.",
	logging_in: "Logging in",
	click_image_show_full_size_version: "Click this image to show the full-size version.",
	show_hidden_content_by_x: "Show hidden content by {names}"
});




</script>




</body>
</html>